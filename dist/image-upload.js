"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),YuanImageUpload=function(){function e(t,n){_classCallCheck(this,e);var a=t.getAttribute("data-preview"),i=t.getAttribute("data-input");this.fileControl=t,this.previewContainer=document.getElementById(a),this.inputControl=document.getElementById(i),this.parseOptions(n),this.addEventListeners()}return _createClass(e,[{key:"parseOptions",value:function(e){return!!e&&(e.uploadURL&&(this.uploadURL=e.uploadURL),e.onPreview&&(this.onPreview=e.onPreview),void(e.onUploadSuccess&&(this.onUploadSuccess=e.onUploadSuccess)))}},{key:"addEventListeners",value:function(){var e=this;this.fileControl.addEventListener("change",function(t){e.handleFiles(),t.preventDefault(),t.stopPropagation()},!1),this.previewContainer.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault();var n=t.target,a=n.classList;a.contains("removeIcon")?e.handleRemoveImage(n.parentElement):a.contains("imgContainer")&&e.previewImg(n.id)})}},{key:"previewImg",value:function(e){this.onPreview&&this.onPreview.call(this,e)}},{key:"handleRemoveImage",value:function(e){var t=e.getAttribute("data-imgid");e.parentNode.removeChild(e);var n=this.inputControl.value.trim();if(n){var a=n.split(";"),i=a.indexOf(t);i>-1&&a.splice(i,1),this.inputControl.value=a.join(";")}}},{key:"handleFiles",value:function(){for(var t=this.fileControl.files,n=t.length,a=0;a<n;a++){var i=t[a],o=/^image\//;if(o.test(i.type)){var r=e.generateUUID();this.createImgContainer(i,r),this.sendFile(i,r)}}}},{key:"createImgContainer",value:function(e,t){var n=document.createElement("div");n.classList.add("imgContainer"),n.id=t;var a=document.createElement("img");a.src="../images/del.png",a.classList.add("removeIcon");var i=new FileReader;i.onload=function(e){n.style.backgroundImage="url("+e.target.result+")"},i.readAsDataURL(e),n.appendChild(a),this.previewContainer.appendChild(n)}},{key:"sendFile",value:function(e,t){var n=this,a=new XMLHttpRequest,i=new FormData,o="responseType"in a;a.open("POST",this.uploadURL,!0),o&&(a.responseType="json"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=o?a.response:JSON.parse(a.responseText);n.handleUploadResponse(e,t)}},i.append("myFile",e),a.send(i)}},{key:"handleUploadResponse",value:function(e,t){if(this.onUploadSuccess){var n=this.onUploadSuccess.call(this,e);this._handleUploadSuccess(n,t)}}},{key:"_handleUploadSuccess",value:function(e,t){this.inputControl.value?this.inputControl.value+=";"+e:this.inputControl.value=e,document.getElementById(t).setAttribute("data-imgid",e)}}],[{key:"generateUUID",value:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)});return t}}]),e}();